<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Video with Camera</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #ffffff;
      }

      #mediaContainer {
        position: absolute;
        width: 480px;
        height: 480px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #staticImage,
      #interactiveVideo {
        height: 100%;
        width: 100%;
        object-fit: cover;
        border-radius: 50%;
      }

      #cameraContainer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: none;
      }

      #cameraView {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: relative;
        z-index: 1;
        filter: blur(5px);
      }
      svg {
        position: absolute;
        left: 50%; /*switch to 50% to move it to the other side on click*/
        top: -50%;
        width: 50vw;
        height: 100vh;
        z-index: 4;
        transform: translate(0, 50%);
      }
      text {
        font-family: monospace;
        font-size: 40px;
        font-style: normal;
        font-variant: normal;
        font-weight: 700;
        line-height: 22px;
      }
      #switch {
        width: 100%;
        height: 100%;
        stroke-width: 3;
        stroke: rgb(0, 0, 0);
      }
      #readingTest {
        scale: 1.4 1;
        position: absolute;
        top: 15%;
        left: -5%;
        width: 100vw;
        height: 100vh;
        z-index: 2;
        filter: blur(5px);
      }
      .glasses {
        position: absolute;
        top: 15%;
        left: -5%;
        width: 110vw;
        height: 100vh;
        z-index: 3;
        fill: rgb(222, 0, 0);
      }

      #diamond {
        width: 111.5vw;
        height: 111vh;
        top: 0;
        display: none;
        pointer-events: none;
        scale: 1;
      }
    </style>
  </head>
  <body>
    <div id="mediaContainer">
      <img id="staticImage" src="firstframe.png" alt="Click to play" />
      <video
        id="interactiveVideo"
        width="480"
        height="480"
        style="display: none"
        autoplay
        muted
        playsinline
      >
        <source src="vid.mp4" type="video/mp4" />
      </video>
    </div>

    <!-- Container for camera view -->
    <div id="cameraContainer" style="display: none">
      <video
        id="cameraView"
        width="480"
        height="480"
        autoplay
        playsinline
      ></video>
      <svg id="switcher">
        <rect id="switch"></rect>
        <text
          id="words"
          x="50%"
          y="50%"
          dominant-baseline="middle"
          text-anchor="middle"
          fill="white"
          font-size="40"
        >
          Switch to RIGHT EYE
        </text>
      </svg>
      <img class="glasses" id="rims" src="rim.svg" alt="glasses" />
      <img class="glasses" id="insides" src="lens.svg" alt="glasses" />
      <img class="glasses" id="diamond" src="diamond.svg" alt="glasses" />

      <img id="readingTest" src="readingtext.png" />
    </div>

    <script>
      var switched = true; 
      var sideWeAreOn = "left";
      document
        .getElementById("staticImage")
        .addEventListener("click", function () {
          var video = document.getElementById("interactiveVideo");
          video.style.display = "block";
          video.play();
          this.style.display = "none";
        });

      document
        .getElementById("switcher")
        .addEventListener("click", function () {
          var switcher = document.getElementById("switcher");
          var words = document.getElementById("words");

          if (switched == false) {
            switcher.style.left = "0";
            switched = true;
            words.textContent = "Switch to LEFT EYE";
            sideWeAreOn = "right";
          } else {
            switcher.style.left = "50%";
            switched = false;
            words.textContent = "Switch to RIGHT EYE";
            sideWeAreOn = "left";
          }
        });

      document
        .getElementById("insides")
        .addEventListener("mousedown", function () {
          var lens = document.getElementById("insides");
          var words = document.getElementById("words");
          var rect = document.getElementById("switch");
          var diamond = document.getElementById("diamond");

          rect.style.fill = "white";
          rect.style.stroke = "red";
          words.style.fill = "transparent";
          diamond.style.display = "block";
          if (sideWeAreOn == "left") { //rect
            rect.style.strokeWidth = "100px";
            rect.setAttribute("rx", "0"); 
            rect.setAttribute("ry", "0"); 
            diamond.style.width = "111.5vw";
            diamond.style.height = "111vh";
            diamond.style.scale = "1";
            diamond.style.top = "0";
          } else { //circ
            rect.style.strokeWidth = "100px"; 
            rect.setAttribute("rx", "550"); 
            rect.setAttribute("ry", "550"); 
            diamond.style.width = "107.5vw";
            diamond.style.height = "60vh";
            diamond.style.scale = "1.5 1";
            diamond.style.top = "19%";
          }
        });

      document
        .getElementById("insides")
        .addEventListener("mouseup", function () {
          var words = document.getElementById("words");
          var rect = document.getElementById("switch");
          var switcher = document.getElementById("switcher");
          rect.setAttribute("rx", "0"); 
          rect.setAttribute("ry", "0"); 

          console.log("up");
          rect.style.fill = "black";
          rect.style.stroke = "black";
          rect.style.strokeWidth = "1px";
          words.style.fill = "white";

          diamond.style.display = "none";

        });

      document
        .getElementById("insides")
        .addEventListener("touchstart", function (e) {
          e.preventDefault();
        });

      document
        .getElementById("insides")
        .addEventListener("touchend", function (e) {
          e.preventDefault();
        });

      document.getElementById("interactiveVideo").addEventListener(
        "ended",
        function () {
          document.getElementById("cameraContainer").style.display = "block";
          document.getElementById("mediaContainer").style.display = "none";
        },
        false
      );

      // preload the camera
      window.onload = function () {
        var cameraView = document.getElementById("cameraView");
        var constraints = {
          video: {
            facingMode: "environment", 
          },
        };

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices
            .getUserMedia(constraints)
            .then(function (stream) {
              cameraView.srcObject = stream;
            })
            .catch(function (error) {
              console.log("Something went wrong!", error);
            });
        }
      };
    </script>
  </body>
</html>
