<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Video with Camera</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #ffffff;
      }

      #mediaContainer {
        position: absolute;
        width: 480px;
        height: 480px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #staticImage,
      video {
        width: 100%;
        height: 100%;
      }

      #cameraContainer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: none;
      }

      #cameraView {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: relative;
        z-index: 1;
        filter: blur(5px);
      }
      svg {
        position: absolute;
        left: 0; /*switch to 50% to move it to the other side on click*/
        top: -50%;
        width: 50vw;
        height: 100vh;
        z-index: 4;
        transform: translate(0, 50%);
      }
      text {
        font-family: monospace;
        font-size: 40px;
        font-style: normal;
        font-variant: normal;
        font-weight: 700;
        line-height: 22px;
      }
      #switch {
        width: 100%;
        height: 100%;
        stroke-width: 3;
        stroke: rgb(0, 0, 0);
      }
      #readingTest {
        scale: 1.4 1;
        position: absolute;
        top: 15%;
        left: -5%;
        width: 100vw;
        height: 100vh;
        z-index: 2;
        filter: blur(5px);
      }
      .glasses {
        position: absolute;
        top: 15%;
        left: -5%;
        width: 110vw;
        height: 100vh;
        z-index: 3;
        fill: rgb(222, 0, 0);
      }
    </style>
  </head>
  <body>
    <div id="mediaContainer">
      <img id="staticImage" src="firstframe.png" alt="Click to play" />
      <video
        id="interactiveVideo"
        width="480"
        height="480"
        style="display: none"
        autoplay
        muted
        playsinline
      >
        <source src="vid.MOV" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
    </div>

    <!-- Container for camera view -->
    <div id="cameraContainer" style="display: none">
      <video
        id="cameraView"
        width="480"
        height="480"
        autoplay
        playsinline
      ></video>
      <svg id="switcher">
        <rect id="switch"></rect>
        <text
          id="words"
          x="50%"
          y="50%"
          dominant-baseline="middle"
          text-anchor="middle"
          fill="white"
          font-size="40"
        >
          Switch to LEFT EYE
        </text>
      </svg>
      <img class="glasses" id= "rims" src='rim.svg' alt='glasses' />
      <img class="glasses" id= "insides" src='lens.svg' alt='glasses' />

      <img id="readingTest" src="readingtext.png" />
    </div>

    <script>
      var switched = false; // intially set switch to false
      document
        .getElementById("staticImage")
        .addEventListener("click", function () {
          var video = document.getElementById("interactiveVideo");
          video.style.display = "block";
          video.play();
          this.style.display = "none";
        });

      document
        .getElementById("switcher")
        .addEventListener("click", function () {
          var switcher = document.getElementById("switcher");
          var words = document.getElementById("words");

          console.log(switched);
          if (switched == false) {
            switcher.style.left = "50%";
            switched = true;
            words.textContent = "Switch to RIGHT EYE";
          } else {
            switcher.style.left = "0";
            switched = false;
            words.textContent = "Switch to LEFT EYE";
          }
        });

      document.getElementById("interactiveVideo").addEventListener(
        "ended",
        function () {
          document.getElementById("cameraContainer").style.display = "block";
          document.getElementById("mediaContainer").style.display = "none";
        },
        false
      );

      // Preload the camera on page load
      window.onload = function () {
        var cameraView = document.getElementById("cameraView");
        var constraints = {
          video: {
            facingMode: "environment", // This will attempt to use the back camera on mobile devices
          },
        };

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices
            .getUserMedia(constraints)
            .then(function (stream) {
              cameraView.srcObject = stream;
            })
            .catch(function (error) {
              console.log("Something went wrong!", error);
            });
        }
      };
    </script>
  </body>
</html>
